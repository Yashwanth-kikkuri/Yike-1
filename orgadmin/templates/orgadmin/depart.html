{% load static %}
{% block extrahead %}

<script src="https://cdn.syncfusion.com/ej2/dist/ej2.min.js" type="text/javascript"></script>
    <link href="https://cdn.syncfusion.com/ej2/material.css" rel="stylesheet">


{% endblock %}

{% block body %}


  <div id="diagram"></div>


<script type="text/javascript">
var data=[
    { 'id': 'parent', 'role': 'Board', 'color': '#71AF17' },
    { 'id': '1', 'role': 'General Manager', 'manager': 'parent', 'color': '#71AF17' },
    { 'id': '2', 'role': 'Human Resource Manager', 'manager': '1', 'color': '#1859B7' },
    { 'id': '3', 'role': 'Trainers', 'manager': '2', 'color': '#2E95D8' },
    { 'id': '4', 'role': 'Recruiting Team', 'manager': '2', 'color': '#2E95D8' },
    { 'id': '6', 'role': 'Design Manager', 'manager': '1', 'color': '#1859B7' },
    { 'id': '7', 'role': 'Design Supervisor', 'manager': '6', 'color': '#2E95D8' },
    { 'id': '8', 'role': 'Development Supervisor', 'manager': '6', 'color': '#2E95D8' },
    { 'id': '10', 'role': 'Operations Manager', 'manager': '1', 'color': '#1859B7' },
    { 'id': '11', 'role': 'Statistics Department', 'manager': '10', 'color': '#2E95D8' },
    { 'id': '12', 'role': 'Logistics Department', 'manager': '10', 'color': '#2E95D8' },
    { 'id': '16', 'role': 'Marketing Manager', 'manager': '1', 'color': '#1859B7' },
    { 'id': '17', 'role': 'Overseas Sales Manager', 'manager': '16', 'color': '#2E95D8' },
    { 'id': '20', 'role': 'Service Department Manager', 'manager': '16', 'color': '#2E95D8' }
];

var items = new ej.data.DataManager(data);
console.log(items)
var diagram = new ej.diagrams.Diagram({
  width: "1000px",
  height: "600px",
  dataSourceSettings: {
      // set the unique field from data source
      id: 'id',
      // set the field which is used to identify the reporting person
      parentId: 'manager',
      // define the employee data
      dataManager: items,
      doBinding: function (node, data) {
          // You will get the employee information in data argument and bind that value directly to node's built-in properties.
          node.annotations = [{ content: data.role }];
          node.style = { fill: data.color };
      }
  },
  layout: {
      // set the layout type
      type: 'OrganizationalChart'
  },
  // set the common settings for node and connector
  getNodeDefaults: nodeDefaults,
  getConnectorDefaults: connectorDefaults,
  // hide the gridlines in the diagram
  snapSettings: { constraints: ej.diagrams.SnapConstraints.None },

  drop: drop

});
diagram.appendTo('#diagram');

function nodeDefaults(node) {
  node.annotations[0].style.color = "white";
  node.width = 120;
  return node;
}

function connectorDefaults(connector) {
  connector.type = 'Orthogonal';
  connector.targetDecorator = { shape: 'None' };
  return connector;
}

function drop(args) {
  if (args.target && args.target instanceof ej.diagrams.Node) {
    var connector = diagram.getObject(args.element.inEdges[0]);
    connector.sourceID = args.target.id;
    diagram.dataBind();
    diagram.doLayout();
    // update your local data source when modifying org chart structure.
    updateDataSource(args.element, args.target);
  }
}

function updateDataSource(source, target) {
  var updateData = data.find(function(element) {
      return element.id === source.data.id;
  });
  if(updateData) {
    updateData.manager = target.data.id;
  }
}


</script>

{% endblock %}
